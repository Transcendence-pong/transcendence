{% load static %}

<!DOCTYPE html>
<html lang="{{ lang }}">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="{% static 'css/styles.css' %}" />
    <title>{{ title | default:"FUcking POng@!" }}</title>
  </head>

  <body class="bg-dark text-white">
  {% block header %}
  <header>
    <div class="position-absolute top-0 end-0 p-3">
      <button class="btn btn-light btn-lg mx-3" type="button">LOG IN</button>
    </div>
  </header>
  {% endblock header %}
  {% block main %}{% endblock main %}
  {% block footer %}{% endblock footer %}
  <script>
    document.addEventListener('DOMContentLoaded', function() {
  // Guarda la URL de la página de inicio
  const homeUrl = window.location.href;

  // Asigna eventos de click a los enlaces con data-ajax=true
  setupAjaxLinks();

  // asignar eventos de click a los enlaces AJAX
  function setupAjaxLinks() {
    document.querySelectorAll('a[data-ajax=true]').forEach(function(link) {
      link.addEventListener('click', function(event) {
        event.preventDefault();
        var url = this.getAttribute('href');
        fetchPage(url, true);
      });
    });
  }

  // cargar y actualizar el contenido
  function fetchPage(url, addToHistory) {
    fetch(url)
      .then(response => response.text())
      .then(data => {
        var parser = new DOMParser();
        var doc = parser.parseFromString(data, 'text/html');
        var newContent = doc.querySelector('main').innerHTML;
        document.querySelector('main').innerHTML = newContent;

        // Vuelve a asignar eventos de click a los enlaces AJAX en el nuevo contenido
        setupAjaxLinks();

        // Agrega al historial si se requiere
        if (addToHistory) {
          history.pushState({ url: url }, '', url);
        }
      })
      .catch(error => {
        console.error('Error loading content: ', error);
      });
  }

  // Maneja los eventos de popstate para la navegación con las flechas
  window.onpopstate = function(event) {
    if (event.state && event.state.url) {
      // Carga el contenido de la URL almacenada en el historial
      fetchPage(event.state.url, false);
    } else {
      // Cargar la página de inicio si no hay estado guardado
      fetchPage(homeUrl, false);
    }
  };
});  
  </script>
  <script
    src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
    crossorigin="anonymous"
  ></script>
</body>
</html>
